# Библиотека *byteutil*

Библиотека предоставляет функции для работы с массивами байт, представленными в виде таблиц.

Создание буффера
```lua
data_buffer():new(bytes: table [опционально]) -> Data_Buffer
```
Принимает массив байт, который будет положен в буффер и возвращает объект буффера


```lua
db.pack(format: str, values: table)
```

Упаковывает переданный массив значений в соответствии со строкой формата. Аргументы должны точно соответствовать значениям, требуемым форматом.
Строка формата состоит из специальных символов и символов значений.

Специальные символы позволяют указать порядок байт для последующих значений (указывается ТОЛЬКО в самом начале формата):

| Символ | Порядок байт         |
| ------ | -------------------- |
| `<`    | Little-endian        |
| `>`    | Big-endian           |


Символы значений описывают тип и размер.

| Символ | Аналог в С++ | Тип Lua  | Размер  |
| ------ | ------------ | -------- | ------- |
| `b`    | int8_t       | number   | 1 байт  |
| `B`    | uint8_t      | number   | 1 байт  |
| `?`    | bool         | boolean  | 1 байт  |
| `h`    | int16_t      | number   | 2 байта |
| `H`    | uint16_t     | number   | 2 байта |
| `i`    | int32_t      | number   | 4 байта |
| `I`    | uint32_t     | number   | 4 байта |
| `l`    | int64_t      | number   | 8 байта |
| `L`    | uint64_t     | number   | 8 байта |
| `F`    | float32      | number   | 4 байта |
| `D`    | float64      | number   | 8 байт  |
| `S`    | string       | string   | >=2 байт|

> [!WARNING]
> Из-за отсутствия в Lua целочисленного типа для значений `l` и `L` гарантируется
> только выходной размер в 8 байт, значение может отличаться от ожидаемого.

```lua
db.unpack(format: str) -> ...
```

Извлекает значения из буффера, ориентируясь на строку формата.

```lua
db.create_type(symbol: string,
               min_size: num,
               pack: function (values: table, order: string) return bytes end
               unpack: function (bytes: table, order: string, i: number, all_bytes_in_buffer: table) return i, values end
)
```

Создаёт новый тип:

- **min_size** — минимальное количество байт для чтения типа.
- **pack** — функция, которая принимает значение и преобразует его в массив байт.
- **unpack** — функция, принимающая `bytes` (массив байт, ограниченный до **min_size**) и `i` (текущая позиция во всём буфере). Она возвращает новую позицию в буфере и прочитанные значения

