# Библиотека *byteutil*

Библиотека предоставляет функции для работы с массивами байт, представленными в виде таблиц.

Создание буффера
```lua
data_buffer():new(bytes: table [опционально], order: string [опционально]) -> Data_Buffer
```
Принимает массив байт, который будет положен в буффер и возвращает объект буффера. А так же принимает порядок байт, который будет использоваться, если символ порядка байт равен `!`


```lua
db.pack(format: str, values: table)
```

Упаковывает переданный массив значений в соответствии со строкой формата. Аргументы должны точно соответствовать значениям, требуемым форматом.
Строка формата состоит из специальных символов и символов значений.

Специальные символы позволяют указать порядок байт для последующих значений (указывается ТОЛЬКО в самом начале формата):

| Символ | Порядок байт         |
| ------ | -------------------- |
| `<`    | Little-endian        |
| `>`    | Big-endian           |
| `!`    | db.order             |


Символы значений описывают тип и размер.

| Символ | Аналог в Rust | Тип Lua  | Размер  |
| ------ | ------------ | -------- | ------- |
| `b`    | i8           | number   | 1 байт  |
| `B`    | u8           | number   | 1 байт  |
| `?`    | bool         | boolean  | 1 байт  |
| `h`    | i16          | number   | 2 байта |
| `H`    | u16          | number   | 2 байта |
| `i`    | i32          | number   | 4 байта |
| `I`    | u32          | number   | 4 байта |
| `l`    | i64          | number   | 8 байта |
| `L`    | u64          | number   | 8 байта |
| `F`    | f32          | number   | 4 байта |
| `D`    | f64          | number   | 8 байт  |
| `S`    | string       | string   | >=2 байт|

> [!WARNING]
> Из-за отсутствия в Lua целочисленного типа для значений `l` и `L` гарантируется
> только выходной размер в 8 байт, значение может отличаться от ожидаемого.

```lua
db.unpack(format: str) -> table<values>
```

Извлекает значения из буффера, ориентируясь на строку формата.

```lua
db.create_type(symbol: string,
               min_size: num,
               pack: function (values: table, order: string) return bytes end,
               unpack: function (bytes: table, order: string, i: number, all_bytes_in_buffer: table) return i, values end
)
```

Создаёт новый тип:

- **min_size** — минимальное количество байт для чтения типа.
- **pack** — функция, которая принимает значение и преобразует его в массив байт.
- **unpack** — функция, принимающая `bytes` (массив байт, ограниченный до **min_size**) и `i` (текущая позиция во всём буфере). Она возвращает новую позицию в буфере и прочитанные значения

