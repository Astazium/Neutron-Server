# Система управления сущностями

Модуль `api.entities` обеспечивает управление сущностями (мобами) на сервере, включая регистрацию, синхронизацию данных и обработку событий спавна/деспавна.

### 1.1. Структура модуля

#### Доступные поля сущностей
- **standart_fields**:
  - `tsf_pos` (vec3): позиция сущности `{x, y, z}`.
  - `tsf_rot` (number): вращение сущности.
  - `tsf_size` (vec3): размер трансформации.
  - `body_phys` (boolean): состояние физики (вкл/выкл).
  - `body_size` (vec3): размер физического тела.
- **custom_fields**: пользовательские поля, например, `hp`.

### 1.2. Основные функции

#### Регистрация сущности
```lua
entities.register(entity_name, config)
```
**Параметры:**
- `entity_name` (string): имя типа сущности (например, `"example:zombie"`).
- `config` (table): конфигурация полей сущности.

**Сигнатура config:**
```lua
{
    standart_fields = {
        tsf_pos = {
            maximum_deviation = number, -- Максимальное отклонение
            evaluate_deviation = function(dist, cur_val, client_val) -- Оценка отклонения
        },
        -- Другие поля...
    },
    custom_fields = {
        hp = {
            maximum_deviation = number,
            evaluate_deviation = function(dist, cur_val, client_val),
            provider = function(uid, field_name) -- Получение значения поля
        }
    }
}
```
- **maximum_devitation** - Максимальное отклонение между значениями поля на сервере и клиенте
- **evalute_deviation** - Функция, вычисляющая значение отклонения на основе:
    1. Расстояния до игрока (dist: number),
    2. Действительного значения поля (cur_val: any),
    3. Значения поля на клиенте (client_val: any)

    функция возвращает величину отклонения, назовём это **d**, после чего, если значение выражения: `math.abs(d) > maximum_devitation` истинно, то новое значение поля отправляется на клиент

### Удаление сущности
```lua
entities.despawn(uid: number)
```
Удаляет сущность у всех клиентов и на сервере

### 1.3. Важные примечания
1. Данные моба не будут отправляться клиентам, если моб находится вне зоны прогрузки или вне зоны видимости игрока
2. Если данные сущности переданы на клиент, но сущность на клиенте не создана, то она автоматически будет создана на нулевых координатах. Из этого следует, что если на клиент были переданы данные сущности без позиции, то на клиенте сущность появится на нулевых координатах